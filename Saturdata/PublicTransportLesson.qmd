---
title: "CA Public Transportation"
author: "Paityn Richardson"
format:
  revealjs:
    theme: simple
    transition: fade
    incremental: true
    scrollable: true
    css: ../styles.css
execute:
  warning: false
  message: false
---

## Public Transportation in Urbn Planning

Public Transit is a Key factor in shaping how a city/society functions 

  - Reduces Traffic Congestion and Pollution (sustainability)
  - Increases access to Jobs, Education, Healthcare, etc.
  - Impacts Housing affordability and community equity

### Useful Analyses include:

- Trends in ridership over time
- Efficiency: Cost per rider or mile
- Equity: *Who uses transit?* *Where is/isn't transit accessible?*

. . .

> *What types of variables should we look for in a dataset/sets to conduct these useful analyses?*

## Dataset: National Transit Database (NTD)

- Data is filtered from US data -> CA specific Data

. . .

```{r}
#| echo: true
#| eval: true
library(readr)
library(tidyverse)

ca_transit <- read_csv("ca_transit.csv")
head(ca_transit, 1)
```

Discuss: 
- *What are the variables? *
-*What kinds of questions can we ask?*

## Wrangling for Summary

> Goal: Compare Agencies Ridership over time

. . .

```{r}
#| echo: true
#| eval: false 
#| code-line-numbers: 1|2|3|4

summary <- ca_transit|>
  group_by(Agency, Year)|>
  summarise(tot_pass = sum(Unlinked.Passenger.Trips), .groups = "drop")|>
  arrange(desc(tot_pass))

```

. . .

> What might be *problematic* about this summary?

## Wrangling for Summary

Total ridership alone doesn’t account for how many people live in the area.
Let’s consider `tot_pass` using `Primary_UZA_Population`:

. . .

```{r}
#| echo: true
#| code-line-numbers: 2|3|4|5

rev_summary <- ca_transit|>
  group_by(Agency, Year)|>
  summarise(tot_pass = sum(Unlinked.Passenger.Trips),
            pop = first(Primary.UZA.Population),
            riders_per_person = round(tot_pass / pop),
            .groups = "drop")
rev_summary
```

. . .

This gives a better sense of how **heavily transit is used relative to population size**.

## Visualizing with ggplot2

> Let's look at the agencies with the top 5 `riders_per_person`

```{r}
#| echo: true
#| code-line-numbers: 1|2|3|4|6|7|8|9|10|11|12

top5 <- rev_summary|>
  filter(Year == 2023)|>
  slice_max(riders_per_person, n = 10)|>
  pull(Agency)

rev_summary |>
  filter(Agency %in% top5) |>
  ggplot(aes(x = Year, y = riders_per_person, color = Agency)) +
  geom_line(linewidth = .6) +
  labs(title = "Transit Ridership Over Time (Top 5 Agencies)",
       y = "Riders/(pop.)",
       x = "Year")
```

## Your Turn

Work With a partner/group to:
  - Filter dataset for 1 agency
  - Create a line graph of ridership over time
  - Analyze patterns in your plot? *What may have caused certain trends you see?*
  
. . .

```{r}
ca_transit |> 
  filter(Agency == "Pomona Valley Transportation Authority") |>
  ggplot(aes(x = Year, y = Unlinked.Passenger.Trips)) +
  geom_line(linewidth = 0.6) +
  labs(
    title = "Pomona Valley Transportation Authority Ridership Over Time",
    y = "Riders/(pop.)",
    x = "Year"
  )
```


## New Dataset: California Transit Stops

- Each **row** is a public transit stop in California.

. . . 

```{r}
#| echo: false
#| eval: true
library(sf)
stop_data <- st_read("output_shapefile/CA_Transit_Stops.shp")

head(stop_data, 1)
```

## Variables

Similar to previous dataset:
  - Agency
New: 
  - stop_name/id
  - routetype
  - geomotry?
  
. . .

This dataset is stored as a **shapefile**.

## What Is a Shapefile?

A **shapefile** is a special type of dataset used to:
- Store geographic information
- Plot points, lines, or areas on a map
- Perform spatial joins and analysis

We’ll use the `sf` package to read and work with shapefiles.

## What Can this Data Tell Us?

On its own, this data shows: 
  - Where stops are located
  - How many stops an agency operates
  - How often stop is used/How many routes serve a stop

What the data doesn't show is:
  - Who lives near a certain stop
  - What the area is like demographically
  - Whether transit access is equitable
  
## Adding Context

. . . 

> A common data wrangling practice used to connect variable that share a common identifier is called **joining**

- We can use functions like `right_join()` or `left_join()` to connect our `stop_data` to a data set with socioeconomic identifiers. 

## Mathlinks Lesson on Joining


## Adding Context

```{r}
#| echo: false
#| eval: true

library(readr)
census_data <- read.csv("acs_clean_data.csv")
```

- Each stop in our `stop_data` is connected to a `GEOID`
- In our census data, each `GEOID` has information on the areas demographics and socioeconomic indicators

```{r}
#| echo: true
#| eval: false

library(tidyverse)


joined_data <- stop_data |>
  left_join(census_data, by = "GEOID")
```


